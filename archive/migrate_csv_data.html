<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        body { 
            background: #0a0a14; 
            color: #e0e0e0; 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px; 
        }
        
        .migration-container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .migration-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .migration-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .step-card {
            background: #1e293b;
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 20px;
        }
        
        .step-title {
            font-size: 18px;
            font-weight: bold;
            color: #3b82f6;
            margin-bottom: 15px;
        }
        
        .step-description {
            color: #9ca3af;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .migrate-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
            width: 100%;
        }
        
        .migrate-btn:hover {
            background: #059669;
        }
        
        .migrate-btn:disabled {
            background: #6b7280;
            cursor: not-allowed;
        }
        
        .progress-section {
            background: #1e293b;
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #374151;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: #3b82f6;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            text-align: center;
            color: #9ca3af;
        }
        
        .results-section {
            background: #1e293b;
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .result-card {
            background: #0f172a;
            border: 1px solid #374151;
            border-radius: 6px;
            padding: 15px;
            text-align: center;
        }
        
        .result-number {
            font-size: 24px;
            font-weight: bold;
            color: #3b82f6;
        }
        
        .result-label {
            color: #9ca3af;
            font-size: 14px;
        }
        
        .back-btn {
            background: #6b7280;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
            margin-bottom: 20px;
        }
        
        .back-btn:hover {
            background: #4b5563;
        }
        
        .status-message {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        
        .status-success {
            background: #10b981;
            color: white;
        }
        
        .status-error {
            background: #ef4444;
            color: white;
        }
        
        .status-info {
            background: #3b82f6;
            color: white;
        }
    </style>
</head>
<body>
    <div class="migration-container">
        <button class="back-btn" onclick="window.history.back()">‚Üê Back to Task Manager</button>
        
        <div class="migration-header">
            <h1>CSV Data Migration Tool</h1>
            <p>Convert your existing CSV KPI data into tasks for the Task Manager</p>
        </div>
        
        <div class="migration-steps">
            <div class="step-card">
                <div class="step-title">1. Accounting Data</div>
                <div class="step-description">
                    Convert revenue tracking, financial metrics, and accounting KPIs into tasks
                </div>
                <button class="migrate-btn" onclick="migrateDepartment('accounting')">Migrate Accounting Data</button>
            </div>
            
            <div class="step-card">
                <div class="step-title">2. Sales Data</div>
                <div class="step-description">
                    Convert sales rep performance, calls, orders, and revenue data into tasks
                </div>
                <button class="migrate-btn" onclick="migrateDepartment('sales')">Migrate Sales Data</button>
            </div>
            
            <div class="step-card">
                <div class="step-title">3. Tech Data</div>
                <div class="step-description">
                    Convert IT tickets, projects, and system maintenance into tasks
                </div>
                <button class="migrate-btn" onclick="migrateDepartment('tech')">Migrate Tech Data</button>
            </div>
            
            <div class="step-card">
                <div class="step-title">4. Marketing Data</div>
                <div class="step-description">
                    Convert marketing campaigns, traffic, and engagement metrics into tasks
                </div>
                <button class="migrate-btn" onclick="migrateDepartment('marketing')">Migrate Marketing Data</button>
            </div>
            
            <div class="step-card">
                <div class="step-title">5. HR Data</div>
                <div class="step-description">
                    Convert employee metrics, attendance, and HR KPIs into tasks
                </div>
                <button class="migrate-btn" onclick="migrateDepartment('hr')">Migrate HR Data</button>
            </div>
            
            <div class="step-card">
                <div class="step-title">6. Customer Retention</div>
                <div class="step-description">
                    Convert support tickets, RMA tracking, and customer service metrics into tasks
                </div>
                <button class="migrate-btn" onclick="migrateDepartment('customer-retention')">Migrate Customer Retention Data</button>
            </div>
            
            <div class="step-card">
                <div class="step-title">7. Swag Data</div>
                <div class="step-description">
                    Convert product mapping, inventory, and merchandise tracking into tasks
                </div>
                <button class="migrate-btn" onclick="migrateDepartment('swag')">Migrate Swag Data</button>
            </div>
            
            <div class="step-card">
                <div class="step-title">8. Ideas Data</div>
                <div class="step-description">
                    Convert strategic planning, growth projections, and business ideas into tasks
                </div>
                <button class="migrate-btn" onclick="migrateDepartment('ideas')">Migrate Ideas Data</button>
            </div>
            
            <div class="step-card">
                <div class="step-title">9. Trade Shows</div>
                <div class="step-description">
                    Convert event tracking, lead generation, and merchandising into tasks
                </div>
                <button class="migrate-btn" onclick="migrateDepartment('trade-shows')">Migrate Trade Shows Data</button>
            </div>
            
            <div class="step-card">
                <div class="step-title">10. Purchasing Data</div>
                <div class="step-description">
                    Convert procurement metrics, vendor performance, and cost tracking into tasks
                </div>
                <button class="migrate-btn" onclick="migrateDepartment('purchasing')">Migrate Purchasing Data</button>
            </div>
        </div>
        
        <div class="progress-section" id="progress-section" style="display: none;">
            <h3>Migration Progress</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
            <div class="progress-text" id="progress-text">Ready to start migration...</div>
        </div>
        
        <div class="results-section" id="results-section" style="display: none;">
            <h3>Migration Results</h3>
            <div class="results-grid" id="results-grid">
                <!-- Results will be populated here -->
            </div>
        </div>
        
        <div id="status-messages"></div>
    </div>

    <script>
        let migrationResults = {
            totalTasks: 0,
            departments: {},
            errors: []
        };

        async function migrateDepartment(department) {
            showProgress();
            updateProgress(0, `Starting migration for ${department}...`);
            
            try {
                // Simulate loading CSV data (in real implementation, you'd load from your CSV files)
                const csvData = await loadCSVData(department);
                updateProgress(25, `Loaded ${csvData.length} rows of data`);
                
                // Convert CSV data to tasks
                const tasks = convertCSVToTasks(csvData, department);
                updateProgress(50, `Converted to ${tasks.length} tasks`);
                
                // Save tasks to task manager
                await saveTasksToManager(tasks);
                updateProgress(75, `Saved ${tasks.length} tasks to task manager`);
                
                // Update results
                migrationResults.departments[department] = tasks.length;
                migrationResults.totalTasks += tasks.length;
                
                updateProgress(100, `Migration completed for ${department}`);
                showResults();
                
                showStatus(`Successfully migrated ${tasks.length} tasks for ${department}`, 'success');
                
            } catch (error) {
                migrationResults.errors.push(`${department}: ${error.message}`);
                showStatus(`Error migrating ${department}: ${error.message}`, 'error');
                updateProgress(0, `Migration failed for ${department}`);
            }
        }

        async function loadCSVData(department) {
            // In a real implementation, you would load the actual CSV files
            // For now, we'll simulate with sample data based on the CSV structure you provided
            
            const sampleData = {
                'accounting': [
                    { 'WEEK OF': '9/20/2024', 'TOTAL REVENUE YTD': '23284508', 'TOTAL REVENUE MTD': '1489240', '% Change YTD': '4%' },
                    { 'WEEK OF': '9/27/2024', 'TOTAL REVENUE YTD': '24773748', 'TOTAL REVENUE MTD': '2242351', '% Change YTD': '7%' }
                ],
                'sales': [
                    { 'SALE REP': 'Diana', 'Calls Made': '84', 'Emails Made': '73', 'New Accounts Opened': '20', 'Order Count': '17' },
                    { 'SALE REP': 'Ish', 'Calls Made': '103', 'Emails Made': '168', 'New Accounts Opened': '0', 'Order Count': '28' }
                ],
                'tech': [
                    { 'WEEK OF': '9/20/2024', 'New Tickets Opened': '25', 'Total Tickets Closed': '27', 'Project': 'Strabo Connector', 'Status': 'In Progress' },
                    { 'WEEK OF': '9/27/2024', 'New Tickets Opened': '55', 'Total Tickets Closed': '49', 'Project': 'Hubspot Cleanup', 'Status': 'On Hold' }
                ],
                'marketing': [
                    { 'WEEK OF': '20-Sep', 'TOTAL BUSINESS WON': '$9012', 'GROWTH OF ORGANIC TRAFFIC': '10%', 'TOTAL TRUE TRAFFIC': '6450' },
                    { 'WEEK OF': '27-Sep', 'TOTAL BUSINESS WON': '$45087.96', 'GROWTH OF ORGANIC TRAFFIC': '19%', 'TOTAL TRUE TRAFFIC': '6413' }
                ],
                'hr': [
                    { 'WEEK OF': '9/20/2024', 'Late Days %': '91%', 'Missing Days %': '86.66%', 'Write ups': '0', 'TOT # OF EMPLOYEES': '53' },
                    { 'WEEK OF': '9/27/2024', 'Late Days %': '93.50%', 'Missing Days %': '95%', 'Write ups': '0', 'TOT # OF EMPLOYEES': '57' }
                ],
                'customer-retention': [
                    { 'WEEK OF': '3/14/2025', 'Total Calls': '34', 'Total Chats': '26', 'Total Emails': '138', 'Replacement Orders': '4' },
                    { 'WEEK OF': '3/21/2025', 'Total Calls': '24', 'Total Chats': '10', 'Total Emails': '124', 'Replacement Orders': '6' }
                ],
                'swag': [
                    { 'Project': 'SWAG Product Mapping', 'Status': 'Completed', 'Assignee': 'Danny', 'Due Date': '6/29/2025' },
                    { 'Project': 'SWAG Process O2C', 'Status': 'In Progress', 'Assignee': 'Danny', 'Due Date': '8/19/2025' }
                ],
                'ideas': [
                    { 'Metric': 'AVG MONTHLY REV', 'CURRENT': '$2320000.00', 'IDEAL FOR 2025': '$3000000.00', 'IDEAL FOR 2026': '$3600000.00' },
                    { 'Metric': 'AVG MONTHLY GM', 'CURRENT': '39%', 'IDEAL FOR 2025': '38%', 'IDEAL FOR 2026': '34%' }
                ],
                'trade-shows': [
                    { 'Event': 'Trade Show 1', 'Event Name': 'Industry Expo 2025', 'Date': '3/15/2025', 'Attendance': '500', 'Leads Generated': '25' },
                    { 'Event': 'Trade Show 2', 'Event Name': 'Product Launch', 'Date': '4/20/2025', 'Attendance': '200', 'Leads Generated': '15' }
                ],
                'purchasing': [
                    { 'WEEK OF': '9/20/2024', 'Purchase Orders': '15', 'Vendor Performance': '95%', 'Cost Savings': '$5000' },
                    { 'WEEK OF': '9/27/2024', 'Purchase Orders': '22', 'Vendor Performance': '92%', 'Cost Savings': '$7500' }
                ]
            };
            
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve(sampleData[department] || []);
                }, 1000);
            });
        }

        function convertCSVToTasks(csvData, department) {
            const tasks = [];
            const departmentNames = {
                'accounting': 'Accounting',
                'sales': 'Sales',
                'tech': 'Tech',
                'marketing': 'Marketing',
                'hr': 'HR',
                'customer-retention': 'Customer Retention',
                'swag': 'Swag',
                'ideas': 'Ideas',
                'trade-shows': 'Trade Shows & Merchandising',
                'purchasing': 'Purchasing'
            };
            
            csvData.forEach((row, index) => {
                // Skip empty rows
                if (!row || Object.values(row).every(val => !val || val.toString().trim() === '')) return;
                
                // Create tasks based on department type
                if (department === 'tech' && row['Project']) {
                    // Tech projects become individual tasks
                    tasks.push({
                        id: `migrated-${department}-${index}`,
                        title: row['Project'] || `Tech Task ${index + 1}`,
                        description: `Migrated from CSV: ${row['Description'] || 'Tech project task'}`,
                        department: department,
                        status: mapStatus(row['Status']),
                        priority: 'Medium',
                        assignee: row['Assignee'] || 'Tech Team',
                        dueDate: row['Due Date'] || new Date().toISOString().split('T')[0],
                        createdDate: new Date().toISOString(),
                        type: 'Project',
                        source: 'CSV Migration'
                    });
                } else {
                    // Other departments create KPI tracking tasks
                    Object.entries(row).forEach(([key, value]) => {
                        if (value && value.toString().trim() !== '' && key !== 'WEEK OF') {
                            tasks.push({
                                id: `migrated-${department}-${index}-${key}`,
                                title: `${key}: ${value}`,
                                description: `KPI tracking for ${departmentNames[department]} - Migrated from CSV`,
                                department: department,
                                status: 'Not Started',
                                priority: 'Low',
                                assignee: 'Department Lead',
                                dueDate: new Date().toISOString().split('T')[0],
                                createdDate: new Date().toISOString(),
                                type: 'KPI',
                                kpiValue: value,
                                kpiMetric: key,
                                source: 'CSV Migration'
                            });
                        }
                    });
                }
            });
            
            return tasks;
        }

        function mapStatus(status) {
            const statusMap = {
                'In Progress': 'In Progress',
                'Completed': 'Completed',
                'On Hold': 'Blocked',
                'Testing': 'In Progress',
                'Not Started': 'Not Started'
            };
            return statusMap[status] || 'Not Started';
        }

        async function saveTasksToManager(tasks) {
            // In a real implementation, you would save to your task manager backend
            return new Promise((resolve) => {
                setTimeout(() => {
                    console.log('Saving tasks:', tasks);
                    resolve();
                }, 500);
            });
        }

        function showProgress() {
            document.getElementById('progress-section').style.display = 'block';
        }

        function updateProgress(percent, message) {
            document.getElementById('progress-fill').style.width = percent + '%';
            document.getElementById('progress-text').textContent = message;
        }

        function showResults() {
            const resultsSection = document.getElementById('results-section');
            const resultsGrid = document.getElementById('results-grid');
            
            resultsGrid.innerHTML = `
                <div class="result-card">
                    <div class="result-number">${migrationResults.totalTasks}</div>
                    <div class="result-label">Total Tasks Created</div>
                </div>
                <div class="result-card">
                    <div class="result-number">${Object.keys(migrationResults.departments).length}</div>
                    <div class="result-label">Departments Migrated</div>
                </div>
                <div class="result-card">
                    <div class="result-number">${migrationResults.errors.length}</div>
                    <div class="result-label">Errors</div>
                </div>
            `;
            
            // Add department breakdown
            Object.entries(migrationResults.departments).forEach(([dept, count]) => {
                const deptCard = document.createElement('div');
                deptCard.className = 'result-card';
                deptCard.innerHTML = `
                    <div class="result-number">${count}</div>
                    <div class="result-label">${dept.charAt(0).toUpperCase() + dept.slice(1)} Tasks</div>
                `;
                resultsGrid.appendChild(deptCard);
            });
            
            resultsSection.style.display = 'block';
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('status-messages');
            const statusElement = document.createElement('div');
            statusElement.className = `status-message status-${type}`;
            statusElement.textContent = message;
            statusDiv.appendChild(statusElement);
            
            // Remove after 5 seconds
            setTimeout(() => {
                statusElement.remove();
            }, 5000);
        }
    </script>
</body>
</html>
