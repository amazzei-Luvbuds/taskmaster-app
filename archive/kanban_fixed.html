<!DOCTYPE html>
<html>
<head>
   <base target="_top">
   <meta charset="utf-8">
   <title>Kanban Board</title>
   <style>
       body { 
           background: #0a0a14; 
           color: #e0e0e0; 
           font-family: Arial, sans-serif; 
           margin: 0; 
           padding: 0; 
       }
       .container {
           max-width: 1200px;
           margin: 0 auto;
           padding: 2rem;
       }
       .header {
           text-align: center;
           margin-bottom: 2rem;
           padding: 2rem;
           background: rgba(20, 20, 40, 0.7);
           border-radius: 8px;
           border: 1px solid #374151;
       }
       .nav-links {
           display: flex;
           gap: 1rem;
           justify-content: center;
           margin-bottom: 2rem;
           flex-wrap: wrap;
       }
       .nav-link {
           background: #60a5fa;
           color: #0a0a14;
           padding: 0.75rem 1.5rem;
           text-decoration: none;
           border-radius: 6px;
           font-weight: bold;
           transition: all 0.3s ease;
       }
       .nav-link:hover {
           background: #3b82f6;
           transform: translateY(-2px);
       }
       .content {
           background: rgba(20, 20, 40, 0.7);
           border: 1px solid #374151;
           border-radius: 8px;
           padding: 2rem;
           min-height: 400px;
       }
       .loading {
           text-align: center;
           color: #60a5fa;
           font-size: 1.2rem;
       }
       .error {
           background: rgba(220, 53, 69, 0.1);
           border: 1px solid #dc3545;
           color: #dc3545;
           padding: 1rem;
           border-radius: 6px;
           margin: 1rem 0;
       }
       .success {
           background: rgba(16, 185, 129, 0.1);
           border: 1px solid #10b981;
           color: #10b981;
           padding: 1rem;
           border-radius: 6px;
           margin: 1rem 0;
       }
   </style>
</head>
<body>
   <div class="container">
       <div class="header">
           <h1>üìã Kanban Board</h1>
           <p>Simplified interface to avoid JavaScript conflicts</p>
       </div>
       
       <div class="nav-links">
           <a href="?page=dashboard" class="nav-link">üè† Dashboard</a>
           <a href="?page=minimal" class="nav-link">üß™ Minimal Test</a>
           <a href="?page=uploader" class="nav-link">ü§ñ AI Uploader</a>
           <a href="?page=admin&key=adminkey" class="nav-link">‚öôÔ∏è Admin</a>
       </div>
       
       <div class="content">
           <div id="status" class="loading">Loading kanban data...</div>
           <div id="content-area"></div>
       </div>
   </div>

   <script>
       // Wait for page to fully load before attempting Google Apps Script calls
       function initializeWhenReady() {
           try {
               const statusDiv = document.getElementById('status');
               const contentDiv = document.getElementById('content-area');
               
               if (typeof google === 'undefined' || !google.script || !google.script.run) {
                   statusDiv.className = 'error';
                   statusDiv.innerHTML = '‚ùå Google Apps Script not available';
                   return;
               }
               
               statusDiv.innerHTML = 'üîÑ Connecting to server...';
               
               google.script.run
                   .withSuccessHandler(function(data) {
                       if (data.error) {
                           statusDiv.className = 'error';
                           statusDiv.innerHTML = '‚ùå Server error: ' + data.error;
                           return;
                       }
                       
                       statusDiv.className = 'success';
                       statusDiv.innerHTML = '‚úÖ Data loaded successfully!';
                       
                       let html = '<h2>Task Summary</h2>';
                       html += '<p><strong>Total Tasks:</strong> ' + (data.tasks ? data.tasks.length : 0) + '</p>';
                       html += '<p><strong>Departments:</strong> ' + (data.departments ? data.departments.join(', ') : 'None') + '</p>';
                       html += '<p><strong>Users:</strong> ' + (data.users ? data.users.length : 0) + '</p>';
                       
                       if (data.tasks && data.tasks.length > 0) {
                           html += '<h3>Recent Tasks</h3>';
                           html += '<ul>';
                           data.tasks.slice(0, 5).forEach(task => {
                               html += '<li><strong>' + (task.taskID || 'No ID') + ':</strong> ' + 
                                      (task.actionItem || 'No title') + ' (' + (task.status || 'No status') + ')</li>';
                           });
                           html += '</ul>';
                       }
                       
                       contentDiv.innerHTML = html;
                   })
                   .withFailureHandler(function(error) {
                       statusDiv.className = 'error';
                       statusDiv.innerHTML = '‚ùå Failed to load data: ' + error.message;
                   })
                   .getKanbanData();
                   
           } catch (e) {
               document.getElementById('status').className = 'error';
               document.getElementById('status').innerHTML = '‚ùå JavaScript error: ' + e.message;
           }
       }
       
       // Multiple strategies to ensure proper initialization
       if (document.readyState === 'loading') {
           document.addEventListener('DOMContentLoaded', function() {
               setTimeout(initializeWhenReady, 100);
           });
       } else {
           setTimeout(initializeWhenReady, 100);
       }
       
       // Fallback for very slow loading
       window.addEventListener('load', function() {
           setTimeout(function() {
               if (document.getElementById('status').classList.contains('loading')) {
                   initializeWhenReady();
               }
           }, 500);
       });
   </script>
</body>
</html>